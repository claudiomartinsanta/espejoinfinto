<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Espejo Infinito</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/OBJLoader.js"></script>
</head>
<body>
  <h1>Espejo Infinito</h1>
  <button id="accessButton">Ingresar Clave</button>
  <button id="cameraButton" style="display:none;">Permitir Cámara</button>
  <button id="loadModelButton" style="display:none;">Cargar Modelo OBJ</button>
  <video id="webcam" autoplay playsinline style="display:none;"></video>
  <div id="sceneContainer" style="width: 100%; height: 500px;"></div>

  <script>
    let scene, camera, renderer, videoTexture
    // Botón para ingresar clave de acceso
    document.getElementById('accessButton').addEventListener('click', () => {
      const password = prompt('Ingrese la clave de acceso:');
      if (password === '1234') { // Cambia la clave según tu preferencia
        alert('Acceso concedido');
        document.getElementById('cameraButton').style.display = 'inline';
      } else {
        alert('Clave incorrecta');
      }
    });

    // Botón para activar la cámara
    document.getElementById('cameraButton').addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('webcam');
        video.srcObject = stream;
        videoTexture = new THREE.VideoTexture(video);
        alert('Cámara activada');
        document.getElementById('loadModelButton').style.display = 'inline';
      } catch (error) {
        alert('Error al acceder a la cámara: ' + error.message);
      }
    });

    // Botón para cargar modelos OBJ
    document.getElementById('loadModelButton').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.obj';
      input.onchange = (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const objLoader = new THREE.OBJLoader();
            const object = objLoader.parse(e.target.result);
            if (videoTexture) {
              const material = new THREE.MeshBasicMaterial({ map: videoTexture });
              object.traverse((child) => {
                if (child.isMesh) child.material = material;
              });
            }
            scene.add(object);
          };
          reader.readAsText(file);
        }
      };
      input.click();
    });

    // Configuración básica de Three.js
    function init() {
      const container = document.getElementById('sceneContainer');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.z = 5;

      renderer = new THREE.WebGLRenderer();
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    init();
  </script>
</body>
<script>
    // Crear el botón
    const boton = document.createElement("button");
    boton.textContent = "Refrescar Página";

    // Agregar funcionalidad para refrescar la página
    boton.onclick = () => location.reload();

    // Insertar el botón en el cuerpo de la página
    document.body.appendChild(boton);
</script>
</html>
